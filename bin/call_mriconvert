#!/usr/bin/env bash

#-----------------------------------------------------------------------------
# Get bash helper functions
source call_bashhelper

#-----------------------------------------------------------------------------
# Create help text
function Usage {
    cat <<USAGE

---------------------------------------------------------------------------------------------------
call_mriconvert

wrapper for FreeSurfer's mriconvert

Usage:
  call_mriconvert <input> <output>

Arguments:
  <input>       image to convert to .nii.gz
  <output>      output image (can be left empty) > will default to <input>.nii.gz

Example:
  call_mriconvert input.mgz output.nii.gz
  
---------------------------------------------------------------------------------------------------

USAGE

}

if [[ $# -lt 1 ]]; then
  Usage && exit 0
fi

#-----------------------------------------------------------------------------
# Start loop

if [[ ! -f $1 ]]; then
  echo
  print_line -
  print_error_msg "$(basename ${0})" "find" "Could not find input image ${BOLD_GREEN}${1}${RESET}"
  exit 1
fi

input=$(readlink -f "${1}")
if [[ -z "${2}" ]]; then
  out=$(dirname "${input}")/$(basename "${input}" .mgz).nii.gz
else
  out="${2}"
fi

cmd=(
  mri_convert
  --in_type mgz
  --out_type nii
  ${1} 
  ${out}
)

eval "${cmd[@]}"
if [[ $? -ne 0 ]]; then
  echo
  print_line -
  print_error_msg "$(basename ${0})" "mri_convert"
  exit 1
fi
