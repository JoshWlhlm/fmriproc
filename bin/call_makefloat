#!/usr/bin/env bash

#-----------------------------------------------------------------------------
# Get bash helper functions
source call_bashhelper

#-----------------------------------------------------------------------------
# Create help text
function Usage {
    cat <<USAGE

---------------------------------------------------------------------------------------------------
call_makefloat

Converts a float64 to float32 image using fslmaths. There's probably nicer ways to do this, so I'm
currently not using this too much..

Usage:
  call_makefloat in_img.nii.gz <out_img.nii.gz>

Arguments:
  <in_img>    image to convert
  <out_img>   output image; if empty, input file will be overwritten

Example:
  call_makefloat input.nii.gz
  call_makefloat input.nii.gz output.nii.gz
  
---------------------------------------------------------------------------------------------------

USAGE

}

if [[ $# -lt 1 ]] ; then
  Usage && exit 0
fi

#-----------------------------------------------------------------------------
# Start loop

if [[ ! -f ${1} ]]; then
  echo
  print_line -
  print_error_msg "$(basename ${0})" "find" "Could not find ${BOLD_GREEN}${1}${RESET}"
  exit 1
else
  input=$(readlink -f "${1}")
fi

if [[ ! -z "$2" ]]; then
  out="$2"
else
  out="${input}"
fi

cmd=(
  fslmaths 
  "${input}"
  "${out}"
  -odt float
)

print_cmd "${cmd[@]}" && eval "${cmd[@]}"
if [[ $? -ne 0 ]]; then
  echo
  print_line -
  print_error_msg "$(basename ${0})" "fslmaths"
  exit 1
fi  
