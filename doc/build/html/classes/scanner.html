

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scanner &mdash; fMRIproc Documentation 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Transform" href="transform.html" />
    <link rel="prev" title="Roi" href="roi.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            fMRIproc Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview of fMRIproc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline_steps.html">Pipeline Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional_software.html">Required External Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster_usage.html">Running fMRIproc on HPC Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting &amp; Common Issues</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Python modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="image.html">Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="planning.html">Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="prf.html">pRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="roi.html">Roi</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Scanner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fmriproc.scanner.Scanner"><code class="docutils literal notranslate"><span class="pre">Scanner</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fmriproc.scanner.Scanner.get_all_coords"><code class="docutils literal notranslate"><span class="pre">Scanner.get_all_coords()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fmriproc.scanner.Scanner.get_fs_coord"><code class="docutils literal notranslate"><span class="pre">Scanner.get_fs_coord()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fmriproc.scanner.Scanner.get_ses1_coord"><code class="docutils literal notranslate"><span class="pre">Scanner.get_ses1_coord()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fmriproc.scanner.Scanner.get_ses2_coord"><code class="docutils literal notranslate"><span class="pre">Scanner.get_ses2_coord()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fmriproc.scanner.Scanner.print_to_console"><code class="docutils literal notranslate"><span class="pre">Scanner.print_to_console()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fmriproc.scanner.Scanner.to_ras"><code class="docutils literal notranslate"><span class="pre">Scanner.to_ras()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fmriproc.scanner.Scanner.to_vox"><code class="docutils literal notranslate"><span class="pre">Scanner.to_vox()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fmriproc.scanner.Scanner.warp_normals"><code class="docutils literal notranslate"><span class="pre">Scanner.warp_normals()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fmriproc.scanner.Scanner.write_nifti"><code class="docutils literal notranslate"><span class="pre">Scanner.write_nifti()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="transform.html">Transform</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bash.html">Bash modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">fMRIproc Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Python modules</a></li>
      <li class="breadcrumb-item active">Scanner</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/classes/scanner.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="scanner">
<h1>Scanner<a class="headerlink" href="#scanner" title="Link to this heading"></a></h1>
<p>The functions and classes in this file are designed transform the target vertex from one space to the line-scanning session space</p>
<dl class="py class" id="module-fmriproc.scanner">
<dt class="sig sig-object py" id="fmriproc.scanner.Scanner">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">fmriproc.scanner.</span></span><span class="sig-name descname"><span class="pre">Scanner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs2ses</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_anat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hemi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ses</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">print_to_console</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fmriproc/scanner.html#Scanner"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fmriproc.scanner.Scanner" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This object combines the information from the CalcBestVertex and pRFCalc classes to fetch the best vertex and related
information from the surfaces. In fact, it runs these classes internally, so you’d only have to specify this class in
order to run the others as well. At the minimum, you need to specify the subject ID as defined in the FreeSurfer/pycortex/
BIDS-anat directory, the dictionary resulting from CalcBestVertex, the matrix mapping session 1 to session 2 (the
‘fs2ses=’ flag), the hemisphere you’re interested in, and the FreeSurfer directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subject</strong> (<em>str</em>) – subject-ID corresponding to the name in the pycortex filestore directory (mandatory!! for looking up how much the
image has been moved when imported from FreeSurfer to Pycortex)</p></li>
<li><p><strong>df</strong> (<em>dict</em>) – output from optimal.target_vertex; a dictionary containing the result from <code class="xref py py-class docutils literal notranslate"><span class="pre">linescanning.optimal.CalcBestVertex</span></code></p></li>
<li><p><strong>fs2ses</strong> (<em>str</em><em>, </em><em>numpy.ndarray</em>) – (4,4) array or path to matrix file mapping FreeSurfer to the new session. It sort of assumes the matrix has been
created with ANTs, so make sure the have run <cite>call_antsregistration</cite>. Enter ‘identity’ to use an identity matrix; this
is useful if you want to plan the line in FreeSurfer-space (before session 2)</p></li>
<li><p><strong>new_anat</strong> (<em>str</em>) – string pointing to the new anatomy file. Generally this is in <cite>&lt;project&gt;/sourcedata/&lt;subject&gt;/&lt;ses&gt;/planning/nifti</cite>,
if you’ve ran <cite>spinoza_lineplanning</cite>. Should be the <strong>fixed</strong> input for call_antsregistration to create <cite>fs2ses</cite></p></li>
<li><p><strong>hemisphere</strong> (<em>str</em>) – hemisphere you’re interested in. Should be ‘right’ or ‘left’. It will do all operations on both hemispheres anyway,
but only print the actual values you need to insert in the MR console for the specified hemisphere</p></li>
<li><p><strong>fs_dir</strong> (<em>str</em>) – path to FreeSurfer directory; will default to SUBJECTS_DIR if left empty.</p></li>
<li><p><strong>ses</strong> (<em>int</em><em>, </em><em>optional</em>) – session ID of new session. Generally this will be <cite>ses-2</cite>, pointing to a line-scanning session. Should be &gt;1</p></li>
<li><p><strong>print_to_console</strong> (<em>bool</em>) – boolean whether to print the translation/rotations that should be inserted in the console to the terminal. Can be
turned off for debugging reasons</p></li>
<li><p><strong>debug</strong> (<em>bool</em>) – boolean for debugging mode; if True, we’ll print more information about the (converted) angles/normal vectors</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>sets attributes in an instantiation of <cite>:class:fmriproc.scanner.Scanner</cite> and will lead to printing of information for the MR-console
(if <cite>print_to_console=True</cite>)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Attr</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scan</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">Scanner</span><span class="p">(</span>
    <span class="n">optimal</span><span class="o">.</span><span class="n">target_vertex</span><span class="p">(</span><span class="s1">&#39;sub-001&#39;</span><span class="p">),</span>
    <span class="n">fs2ses</span><span class="o">=</span><span class="s1">&#39;genaff.mat&#39;</span><span class="p">,</span>
    <span class="n">hemi</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">new_anat</span><span class="o">=</span><span class="s1">&#39;path/to/sub-001_ses-2_T1w.nii.gz&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="fmriproc.scanner.Scanner.get_all_coords">
<span class="sig-name descname"><span class="pre">get_all_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hemi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lh'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'both'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fmriproc/scanner.html#Scanner.get_all_coords"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fmriproc.scanner.Scanner.get_all_coords" title="Link to this definition"></a></dt>
<dd><p>Just print all coordinates to the terminal</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fmriproc.scanner.Scanner.get_fs_coord">
<span class="sig-name descname"><span class="pre">get_fs_coord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hemi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lh'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fmriproc/scanner.html#Scanner.get_fs_coord"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fmriproc.scanner.Scanner.get_fs_coord" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fmriproc.scanner.Scanner.get_ses1_coord">
<span class="sig-name descname"><span class="pre">get_ses1_coord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hemi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lh'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fmriproc/scanner.html#Scanner.get_ses1_coord"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fmriproc.scanner.Scanner.get_ses1_coord" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fmriproc.scanner.Scanner.get_ses2_coord">
<span class="sig-name descname"><span class="pre">get_ses2_coord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hemi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lh'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fmriproc/scanner.html#Scanner.get_ses2_coord"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fmriproc.scanner.Scanner.get_ses2_coord" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fmriproc.scanner.Scanner.print_to_console">
<span class="sig-name descname"><span class="pre">print_to_console</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hemi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fmriproc/scanner.html#Scanner.print_to_console"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fmriproc.scanner.Scanner.print_to_console" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fmriproc.scanner.Scanner.to_ras">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">to_ras</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coord</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fmriproc/scanner.html#Scanner.to_ras"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fmriproc.scanner.Scanner.to_ras" title="Link to this definition"></a></dt>
<dd><p>get voxel coordinate from RAS</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fmriproc.scanner.Scanner.to_vox">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">to_vox</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coord</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fmriproc/scanner.html#Scanner.to_vox"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fmriproc.scanner.Scanner.to_vox" title="Link to this definition"></a></dt>
<dd><p>get RAS coordinate from voxel</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fmriproc.scanner.Scanner.warp_normals">
<span class="sig-name descname"><span class="pre">warp_normals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hemi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'both'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">system</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'RAS'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fmriproc/scanner.html#Scanner.warp_normals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fmriproc.scanner.Scanner.warp_normals" title="Link to this definition"></a></dt>
<dd><p>Apply a rigid-body transformation on a vector. Important here is that the coordinate systems used are the same: e.g.,
only warp an RAS-vector with an RAS-matrix, and a LPS-vector with an LPS-matrix. ANTs outputs per definition an
LPS-matrix, so we’d need to convert that with ConvertTransformFile first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hemi</strong> (<em>str</em><em> (</em><em>default = 'both'</em><em>)</em>) – the dataframe has a normal vector for the left hemisphere and right hemisphere. Easiest to leave this to what it
is.</p></li>
<li><p><strong>system</strong> (<em>str</em><em> (</em><em>default = 'ras'</em><em>)</em>) – if we warp an RAS-vector we need an RAS matrix, if we warp an LPS vector we need an LPS matrix. The function
totate_normal will actually deal with this problem</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">warp_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp_normals</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fmriproc.scanner.Scanner.write_nifti">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">write_nifti</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coord</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/fmriproc/scanner.html#Scanner.write_nifti"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fmriproc.scanner.Scanner.write_nifti" title="Link to this definition"></a></dt>
<dd><p>create nifti image from voxel coordinate</p>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="roi.html" class="btn btn-neutral float-left" title="Roi" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="transform.html" class="btn btn-neutral float-right" title="Transform" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>